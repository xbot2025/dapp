import{a as it,b as at,c as R,d as L}from"./web3-core-CWz9SCqJ.js";import{a as V,F as J,D as T,B as ot}from"./web3-types-DPR2whjI.js";import{W as y,v as rt,c as B,S as U}from"./web3-errors-DMH_yRvG.js";import{i as F,t as ct,v as X,W as ut}from"./web3-validator-CNlFpTpb.js";import"./setimmediate-24HubXkZ.js";import{b as q,A as D,d as tt,s as E,a as Y,g as dt,c as lt,e as pt,f as ht,N as z}from"./web3-eth-BBFvEiUQ.js";import{e as st,j as x,b as K,c as ft,f as mt,g as vt,h as $,k as W,i as gt,l as bt,m as yt,n as Ot,d as k}from"./web3-eth-abi-G-NhLkEv.js";import{i as _,k as A,D as nt,m as M,F as N,G as I,q as jt}from"./web3-utils-4vEJ-nRv.js";import"./@ethereumjs-yCrz_XbO.js";const Q=({address:l},n,t)=>{var e,a;const r=t==null?void 0:t.topics,c=(e=t==null?void 0:t.filter)!==null&&e!==void 0?e:{},d={};if(_(t==null?void 0:t.fromBlock)||(d.fromBlock=A(q.properties.number,t==null?void 0:t.fromBlock,{number:V.HEX,bytes:J.HEX})),_(t==null?void 0:t.toBlock)||(d.toBlock=A(q.properties.number,t==null?void 0:t.toBlock,{number:V.HEX,bytes:J.HEX})),r&&Array.isArray(r))d.topics=[...r];else if(d.topics=[],!n||n.anonymous||[D,"allEvents"].includes(n.name)||d.topics.push((a=n.signature)!==null&&a!==void 0?a:st(x(n))),![D,"allEvents"].includes(n.name)&&n.inputs)for(const o of n.inputs){if(!o.indexed)continue;const s=c[o.name];s?Array.isArray(s)?d.topics.push(s.map(i=>K(o.type,i))):o.type==="string"?d.topics.push(nt(s)):d.topics.push(K(o.type,s)):d.topics.push(null)}return d.topics.length||delete d.topics,l&&(d.address=l.toLowerCase()),d},P=(l,n,t)=>{const e=Array.isArray(l.inputs)?l.inputs.length:0;if(l.inputs&&e!==n.length)throw new y(`The number of arguments is not matching the methods required number. You need to pass ${e} arguments.`);let a;if(a=l.inputs?ft(Array.isArray(l.inputs)?l.inputs:[],n).replace("0x",""):mt(n).replace("0x",""),vt(l)){if(!t)throw new y("The contract has no contract data option set. This is necessary to append the constructor parameters.");return t.startsWith("0x")?`${t}${a}`:`0x${t}${a}`}return`${$(l)}${a}`};class et extends it{constructor(n,t){super(n,t),this.address=n.address,this.topics=n.topics,this.abi=n.abi,this.jsonInterface=n.jsonInterface}_buildSubscriptionParams(){return["logs",{address:this.address,topics:this.topics}]}formatSubscriptionResult(n){return tt(this.abi,n,this.jsonInterface,super.returnFormat)}}const C=(l,n,t,e)=>{var a,r;const c={};return _(l.data)&&e!=="both"||(c.data=P(n,t,(a=l.data)!==null&&a!==void 0?a:l.input)),_(l.input)&&e!=="both"||(c.input=P(n,t,(r=l.input)!==null&&r!==void 0?r:l.data)),_(c.input)&&_(c.data)&&(c[e]=P(n,t)),{data:c.data,input:c.input}},H=({abi:l,params:n,options:t,contractOptions:e})=>{var a,r,c;if(!((c=(r=(a=t==null?void 0:t.input)!==null&&a!==void 0?a:t==null?void 0:t.data)!==null&&r!==void 0?r:e.input)!==null&&c!==void 0?c:e.data)&&!(t!=null&&t.to)&&!e.address)throw new y("Contract address not specified");if(!(t!=null&&t.from)&&!e.from)throw new y('Contract "from" address not specified');let d=M({to:e.address,gas:e.gas,gasPrice:e.gasPrice,from:e.from,input:e.input,maxPriorityFeePerGas:e.maxPriorityFeePerGas,maxFeePerGas:e.maxFeePerGas,data:e.data},t);const o=C(d,l,n,t==null?void 0:t.dataInputFill);return d=Object.assign(Object.assign({},d),{data:o.data,input:o.input}),d},Z=l=>typeof l=="object"&&!_(l)&&Object.keys(l).length!==0&&!N(l);var wt=function(l,n,t,e){return new(t||(t=Promise))(function(a,r){function c(s){try{o(e.next(s))}catch(i){r(i)}}function d(s){try{o(e.throw(s))}catch(i){r(i)}}function o(s){var i;s.done?a(s.value):(i=s.value,i instanceof t?i:new t(function(u){u(i)})).then(c,d)}o((e=e.apply(l,n||[])).next())})};class Ft{_contractMethodDeploySend(n){const t={transactionResolver:e=>{if(e.status===BigInt(0))throw new y("code couldn't be stored",e);const a=this.parent.clone();return a.options.address=e.contractAddress,a},contractAbi:this.parent.options.jsonInterface,checkRevertBeforeSending:!1};return F(this.parent.getTransactionMiddleware())?E(this.parent,n,this.parent.defaultReturnFormat,t):E(this.parent,n,this.parent.defaultReturnFormat,t,this.parent.getTransactionMiddleware())}constructor(n,t){this.parent=n,this.deployOptions=t;const{args:e,abi:a,contractOptions:r,deployData:c}=this.calculateDeployParams();this.args=e,this.constructorAbi=a,this.contractOptions=r,this.deployData=c}send(n){const t=Object.assign({},n),e=this.populateTransaction(t);return this._contractMethodDeploySend(e)}populateTransaction(n){var t,e;const a=Object.assign(Object.assign({},this.contractOptions),{from:(e=(t=this.contractOptions.from)!==null&&t!==void 0?t:this.parent.defaultAccount)!==null&&e!==void 0?e:void 0}),r=H({abi:this.constructorAbi,params:this.args,options:Object.assign(Object.assign({},n),{dataInputFill:this.parent.contractDataInputFill}),contractOptions:a});return r.dataInputFill&&delete r.dataInputFill,r}calculateDeployParams(){var n,t,e,a,r,c;let d=this.parent.options.jsonInterface.find(i=>i.type==="constructor");d||(d={type:"constructor",stateMutability:""});const o=A({format:"bytes"},(t=(n=this.deployOptions)===null||n===void 0?void 0:n.input)!==null&&t!==void 0?t:this.parent.options.input,T),s=A({format:"bytes"},(a=(e=this.deployOptions)===null||e===void 0?void 0:e.data)!==null&&a!==void 0?a:this.parent.options.data,T);if(!(o&&o.trim()!=="0x"||s&&s.trim()!=="0x"))throw new y("contract creation without any data provided.");return{args:(c=(r=this.deployOptions)===null||r===void 0?void 0:r.arguments)!==null&&c!==void 0?c:[],abi:d,contractOptions:Object.assign(Object.assign({},this.parent.options),{input:o,data:s}),deployData:o??s}}estimateGas(n){return wt(this,arguments,void 0,function*(t,e=this.parent.defaultReturnFormat){const a=Object.assign({},t);return this.parent.contractMethodEstimateGas({abi:this.constructorAbi,params:this.args,returnFormat:e,options:a,contractOptions:this.contractOptions})})}encodeABI(){return P(this.constructorAbi,this.args,A({format:"bytes"},this.deployData,this.parent.defaultReturnFormat))}decodeData(n){return Object.assign(Object.assign({},W(this.constructorAbi,n.replace(this.deployData,""),!1)),{__method__:this.constructorAbi.type})}}var _t=function(l,n,t,e){return new(t||(t=Promise))(function(a,r){function c(s){try{o(e.next(s))}catch(i){r(i)}}function d(s){try{o(e.throw(s))}catch(i){r(i)}}function o(s){var i;s.done?a(s.value):(i=s.value,i instanceof t?i:new t(function(u){u(i)})).then(c,d)}o((e=e.apply(l,n||[])).next())})};class It extends at{constructor(n,t){super(n.requestManager,n.registeredSubscriptions),this.parentContract=t}subscribe(n,t){const e=Object.create(null,{subscribe:{get:()=>super.subscribe}});return _t(this,arguments,void 0,function*(a,r,c=T){return e.subscribe.call(this,a,r??this.parentContract.options,c)})}}var w=function(l,n,t,e){return new(t||(t=Promise))(function(a,r){function c(s){try{o(e.next(s))}catch(i){r(i)}}function d(s){try{o(e.throw(s))}catch(i){r(i)}}function o(s){var i;s.done?a(s.value):(i=s.value,i instanceof t?i:new t(function(u){u(i)})).then(c,d)}o((e=e.apply(l,n||[])).next())})};const At={logs:et,newHeads:z,newBlockHeaders:z};class S extends R{get subscriptionManager(){return this._subscriptionManager}constructor(n,t,e,a,r){var c,d,o;const s=N(t)?t:N(e)?e:void 0;let i,u;if(i=Z(t)?t:Z(e)?e:a,u=typeof t=="object"&&"provider"in t?t.provider:typeof e=="object"&&"provider"in e?e.provider:typeof a=="object"&&"provider"in a?a.provider:S.givenProvider,super(Object.assign(Object.assign({},i),{provider:u,registeredSubscriptions:At})),this.syncWithContext=!1,this._functions={},this._subscriptionManager=new It(super.subscriptionManager,this),i!=null&&i.wallet&&(this._wallet=i.wallet),i!=null&&i.accountProvider&&(this._accountProvider=i.accountProvider),!F(s)&&!F(s.data)&&!F(s.input)&&this.config.contractDataInputFill!=="both")throw new rt({data:s.data,input:s.input});this._overloadedMethodAbis=new Map;const p=I(a)?a:I(e)?e:r??this.defaultReturnFormat,v=typeof t=="string"?t:void 0;this.config.contractDataInputFill=(c=s==null?void 0:s.dataInputFill)!==null&&c!==void 0?c:this.config.contractDataInputFill,this._parseAndSetJsonInterface(n,p),this.defaultReturnFormat!==p&&(this.defaultReturnFormat=p),F(v)||this._parseAndSetAddress(v,p),this.options={address:v,jsonInterface:this._jsonInterface,gas:(d=s==null?void 0:s.gas)!==null&&d!==void 0?d:s==null?void 0:s.gasLimit,gasPrice:s==null?void 0:s.gasPrice,from:s==null?void 0:s.from,input:s==null?void 0:s.input,data:s==null?void 0:s.data},this.syncWithContext=(o=s==null?void 0:s.syncWithContext)!==null&&o!==void 0&&o,i instanceof R&&this.subscribeToContextEvents(i),Object.defineProperty(this.options,"address",{set:b=>this._parseAndSetAddress(b,p),get:()=>this._address}),Object.defineProperty(this.options,"jsonInterface",{set:b=>this._parseAndSetJsonInterface(b,p),get:()=>this._jsonInterface}),i instanceof R&&i.on(L.CONFIG_CHANGE,b=>{this.setConfig({[b.name]:b.newValue})})}setTransactionMiddleware(n){this.transactionMiddleware=n}getTransactionMiddleware(){return this.transactionMiddleware}get events(){return this._events}get methods(){return this._methods}clone(){let n;return n=this.options.address?new S([...this._jsonInterface,...this._errorsInterface],this.options.address,{gas:this.options.gas,gasPrice:this.options.gasPrice,from:this.options.from,input:this.options.input,data:this.options.data,provider:this.currentProvider,syncWithContext:this.syncWithContext,dataInputFill:this.config.contractDataInputFill},this.getContextObject()):new S([...this._jsonInterface,...this._errorsInterface],{gas:this.options.gas,gasPrice:this.options.gasPrice,from:this.options.from,input:this.options.input,data:this.options.data,provider:this.currentProvider,syncWithContext:this.syncWithContext,dataInputFill:this.config.contractDataInputFill},this.getContextObject()),this.context&&n.subscribeToContextEvents(this.context),n}deploy(n){return new Ft(this,n)}getPastEvents(n,t,e){return w(this,void 0,void 0,function*(){var a;const r=typeof n=="string"?n:D,c=typeof n=="string"||I(n)?I(t)?{}:t:n,d=I(n)?n:I(t)?t:e??this.defaultReturnFormat,o=r==="allEvents"||r===D?Y:this._jsonInterface.find(f=>"name"in f&&f.name===r);if(!o)throw new y(`Event ${String(r)} not found.`);const{fromBlock:s,toBlock:i,topics:u,address:p}=Q(this.options,o,c??{}),v=yield dt(this,{fromBlock:s,toBlock:i,topics:u,address:p},d),b=v?v.map(f=>typeof f=="string"?f:tt(o,f,this._jsonInterface,d)):[],h=(a=c==null?void 0:c.filter)!==null&&a!==void 0?a:{},m=Object.keys(h);return m.length>0?b.filter(f=>typeof f=="string"||m.every(g=>{var O;if(Array.isArray(h[g]))return h[g].some(G=>String(f.returnValues[g]).toUpperCase()===String(G).toUpperCase());const j=(O=o.inputs)===null||O===void 0?void 0:O.filter(G=>G.name===g)[0];return j!=null&&j.indexed&&j.type==="string"&&nt(h[g])===String(f.returnValues[g])?!0:String(f.returnValues[g]).toUpperCase()===String(h[g]).toUpperCase()})):b})}_parseAndSetAddress(n,t=this.defaultReturnFormat){this._address=n&&jt(A({format:"address"},n,t))}decodeMethodData(n){const t=n.slice(0,10),e=this._jsonInterface.filter(a=>a.type!=="error").find(a=>t===$(x(a)));if(!e)throw new y(`The ABI for the provided method signature ${t} was not found.`);return W(e,n)}_parseAndSetJsonInterface(n,t=this.defaultReturnFormat){var e,a;this._functions={},this._methods={},this._events={};let r=[];const c=n.filter(o=>o.type!=="error"),d=n.filter(o=>gt(o));for(const o of c){const s=Object.assign(Object.assign({},o),{signature:""});if(bt(s)){const i=x(s),u=$(i);s.methodNameWithInputs=i,s.signature=u,s.constant=s.stateMutability==="view"||s.stateMutability==="pure"||s.constant,s.payable=s.stateMutability==="payable"||s.payable,this._overloadedMethodAbis.set(s.name,[...(e=this._overloadedMethodAbis.get(s.name))!==null&&e!==void 0?e:[],s]);const p=(a=this._overloadedMethodAbis.get(s.name))!==null&&a!==void 0?a:[],v=this._createContractMethod(p,d),b=this._createContractMethod(p,d,!0);this._functions[i]={signature:u,method:b},this._methods[s.name]=v,this._methods[i]=b,this._methods[u]=b}else if(yt(s)){const i=x(s),u=st(i),p=this._createContractEvent(s,t);s.signature=u,i in this._events&&s.name!=="bound"||(this._events[i]=p),this._events[s.name]=p,this._events[u]=p}r=[...r,s]}this._events.allEvents=this._createContractEvent(Y,t),this._jsonInterface=[...r],this._errorsInterface=d}_getAbiParams(n,t){var e;try{return ct((e=n.inputs)!==null&&e!==void 0?e:[],t)}catch(a){throw new y(`Invalid parameters for method ${n.name}: ${a.message}`)}}_createContractMethod(n,t,e=!1){const a=n[n.length-1];return(...r)=>{var c,d,o;let s;const i=(d=e?(c=this._overloadedMethodAbis.get(a.name))===null||c===void 0?void 0:c.filter(h=>h.signature===a.signature):this._overloadedMethodAbis.get(a.name))!==null&&d!==void 0?d:[];let u=i[0];const p=t,v=i.filter(h=>{var m;return((m=h.inputs)!==null&&m!==void 0?m:[]).length===r.length});if(i.length===1||v.length===0)s=this._getAbiParams(u,r),X.validate((o=a.inputs)!==null&&o!==void 0?o:[],s);else{const h=[],m=[];for(const f of v)try{s=this._getAbiParams(f,r),X.validate(f.inputs,s),m.push(f)}catch(g){h.push(g)}if(m.length===1?[u]=m:m.length>1&&([u]=m,console.warn(`Multiple methods found that is compatible with the given inputs.
	Found ${m.length} compatible methods: ${JSON.stringify(m.map(f=>`${f.methodNameWithInputs} (signature: ${f.signature})`))} 
	The first one will be used: ${u.methodNameWithInputs}`)),h.length===v.length)throw new ut(h)}const b={arguments:s,call:(h,m)=>w(this,void 0,void 0,function*(){return this._contractMethodCall(u,s,p,h,m)}),send:h=>this._contractMethodSend(u,s,p,h),populateTransaction:(h,m)=>{var f,g;let O=m??this.options;O=Object.assign(Object.assign({},O),{input:void 0,from:(g=(f=O==null?void 0:O.from)!==null&&f!==void 0?f:this.defaultAccount)!==null&&g!==void 0?g:void 0});const j=H({abi:a,params:r,options:Object.assign(Object.assign({},h),{dataInputFill:this.config.contractDataInputFill}),contractOptions:O});return j.dataInputFill&&delete j.dataInputFill,j},estimateGas:(h,...m)=>w(this,[h,...m],void 0,function*(f,g=this.defaultReturnFormat){return this.contractMethodEstimateGas({abi:u,params:s,returnFormat:g,options:f})}),encodeABI:()=>P(u,s),decodeData:h=>W(u,h),createAccessList:(h,m)=>w(this,void 0,void 0,function*(){return this._contractMethodCreateAccessList(u,s,p,h,m)})};return u.stateMutability,b}}_contractMethodCall(n,t,e,a,r){return w(this,void 0,void 0,function*(){var c;const d=(({abi:o,params:s,options:i,contractOptions:u})=>{if(!(i!=null&&i.to)&&!u.address)throw new y("Contract address not specified");let p=M({to:u.address,gas:u.gas,gasPrice:u.gasPrice,from:u.from,input:u.input,maxPriorityFeePerGas:u.maxPriorityFeePerGas,maxFeePerGas:u.maxFeePerGas,data:u.data},i);const v=C(p,o,s,i==null?void 0:i.dataInputFill);return p=Object.assign(Object.assign({},p),{data:v.data,input:v.input}),p})({abi:n,params:t,options:Object.assign(Object.assign({},a),{dataInputFill:this.config.contractDataInputFill}),contractOptions:Object.assign(Object.assign({},this.options),{from:(c=this.options.from)!==null&&c!==void 0?c:this.config.defaultAccount})});try{const o=yield lt(this,d,r,this.defaultReturnFormat);return Ot(n,o)}catch(o){throw o instanceof B&&k(e,o.cause),o}})}_contractMethodCreateAccessList(n,t,e,a,r){return w(this,void 0,void 0,function*(){var c;const d=(({abi:o,params:s,options:i,contractOptions:u})=>{if(!(i!=null&&i.to)&&!u.address)throw new y("Contract address not specified");if(!(i!=null&&i.from)&&!u.from)throw new y('Contract "from" address not specified');let p=M({to:u.address,gas:u.gas,gasPrice:u.gasPrice,from:u.from,input:u.input,maxPriorityFeePerGas:u.maxPriorityFeePerGas,maxFeePerGas:u.maxFeePerGas,data:u.data},i);const v=C(p,o,s,i==null?void 0:i.dataInputFill);return p=Object.assign(Object.assign({},p),{data:v.data,input:v.input}),p})({abi:n,params:t,options:Object.assign(Object.assign({},a),{dataInputFill:this.config.contractDataInputFill}),contractOptions:Object.assign(Object.assign({},this.options),{from:(c=this.options.from)!==null&&c!==void 0?c:this.config.defaultAccount})});try{return pt(this,d,r,this.defaultReturnFormat)}catch(o){throw o instanceof B&&k(e,o.cause),o}})}_contractMethodSend(n,t,e,a,r){var c,d;let o=r??this.options;o=Object.assign(Object.assign({},o),{input:void 0,from:(d=(c=o.from)!==null&&c!==void 0?c:this.defaultAccount)!==null&&d!==void 0?d:void 0});const s=H({abi:n,params:t,options:Object.assign(Object.assign({},a),{dataInputFill:this.config.contractDataInputFill}),contractOptions:o}),i=F(this.transactionMiddleware)?E(this,s,this.defaultReturnFormat,{checkRevertBeforeSending:!1,contractAbi:this._jsonInterface}):E(this,s,this.defaultReturnFormat,{checkRevertBeforeSending:!1,contractAbi:this._jsonInterface},this.transactionMiddleware);return i.on("error",u=>{u instanceof B&&k(e,u.cause)}),i}contractMethodEstimateGas(n){return w(this,arguments,void 0,function*({abi:t,params:e,returnFormat:a,options:r,contractOptions:c}){const d=(({abi:o,params:s,options:i,contractOptions:u})=>{let p=M({to:u.address,gas:u.gas,gasPrice:u.gasPrice,from:u.from,input:u.input,data:u.data},i);const v=C(p,o,s,i==null?void 0:i.dataInputFill);return p=Object.assign(Object.assign({},p),{data:v.data,input:v.input}),p})({abi:t,params:e,options:Object.assign(Object.assign({},r),{dataInputFill:this.config.contractDataInputFill}),contractOptions:c??this.options});return ht(this,d,ot.LATEST,a??this.defaultReturnFormat)})}_createContractEvent(n,t=this.defaultReturnFormat){return(...e)=>{var a;const{topics:r,fromBlock:c}=Q(this.options,n,e[0]),d=new et({address:this.options.address,topics:r,abi:n,jsonInterface:this._jsonInterface},{subscriptionManager:this.subscriptionManager,returnFormat:t});return F(c)||this.getPastEvents(n.name,{fromBlock:c,topics:r},t).then(o=>{o&&o.forEach(s=>d.emit("data",s))}).catch(o=>{d.emit("error",new U("Failed to get past events.",o))}),(a=this.subscriptionManager)===null||a===void 0||a.addSubscription(d).catch(o=>{d.emit("error",new U("Failed to subscribe.",o))}),d}}subscribeToContextEvents(n){const t=this;this.context=n,t.syncWithContext&&n.on(L.CONFIG_CHANGE,e=>{t.setConfig({[e.name]:e.newValue})})}}export{S as C};
