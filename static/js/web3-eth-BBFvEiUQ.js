import{p as vt}from"./web3-eth-accounts-BPfGOTLV.js";import"./crc-32-BDf5M4FI.js";import{e as ht,T as yt,U as D,f as bt,L as U,g as gt,h as wt,i as tt,j as xt,k as et,l as Pt,m as kt,c as C,n as jt,I as nt,o as ot,p as H,q as it}from"./web3-errors-DMH_yRvG.js";import{i as f,v as Ft,W as Rt,a as Bt,b as Ot,c as St,d as B,e as Et}from"./web3-validator-CNlFpTpb.js";import{E as w,H as S,D as M,F as Gt,a as Ct}from"./web3-types-DPR2whjI.js";import{W as Ht,a as Tt}from"./web3-core-CWz9SCqJ.js";import{k as d,m as It,t as W,l as z,r as At,n as rt,p as Mt,o as T}from"./web3-utils-4vEJ-nRv.js";import"./setimmediate-24HubXkZ.js";import{g as at,s as Nt,a as qt,c as Lt,e as Dt,b as Ut,d as Wt,f as zt,h as Vt,i as Jt,j as Kt}from"./web3-rpc-methods-DYFCdkrw.js";import"./web3-net-BeCJThvc.js";import{i as Xt,d as _t,a as Qt}from"./web3-eth-abi-G-NhLkEv.js";const V={type:"object",properties:{accessList:{type:"null"},maxFeePerGas:{type:"null"},maxPriorityFeePerGas:{type:"null"}}},J={type:"object",properties:{maxFeePerGas:{type:"null"},maxPriorityFeePerGas:{type:"null"}}},K={type:"object",properties:{gasPrice:{type:"null"}}},F=(a,i,t)=>{try{Ft.validateJSONSchema(a,i)}catch(e){throw e instanceof Rt?new ht(e.errors,t):e}},Yt=a=>{var i,t;const e=a;if(!f(e.type)){let o;switch(e.type){case"0x0":o=V;break;case"0x1":o=J;break;case"0x2":o=K;break;default:return d({format:"uint"},e.type,w)}return F(o,e,e.type),d({format:"uint"},e.type,w)}if(!f(e.maxFeePerGas)||!f(e.maxPriorityFeePerGas))return F(K,e,"0x2"),"0x2";if(!f(e.accessList))return F(J,e,"0x1"),"0x1";const s=(i=e.hardfork)!==null&&i!==void 0?i:(t=e.common)===null||t===void 0?void 0:t.hardfork;if(!f(s)){const o=Object.keys(S).indexOf(s);if(o>=Object.keys(S).indexOf("london"))return f(e.gasPrice)?"0x2":"0x0";if(o===Object.keys(S).indexOf("berlin"))return"0x0"}return f(e.gasPrice)?void 0:(F(V,e,"0x0"),"0x0")},Zt=(a,i)=>{var t;return((t=i==null?void 0:i.transactionTypeParser)!==null&&t!==void 0?t:Yt)(a)},N={type:"array",items:Object.assign({},{type:"object",properties:{address:{format:"address"},storageKeys:{type:"array",items:{format:"bytes32"}}}})},$t={type:"object",properties:{accessList:Object.assign({},N),gasUsed:{type:"string"}}},X={type:"string",enum:["goerli","kovan","mainnet","rinkeby","ropsten","sepolia"]},_={type:"string",enum:["arrowGlacier","berlin","byzantium","chainstart","constantinople","dao","homestead","istanbul","london","merge","muirGlacier","petersburg","shanghai","spuriousDragon","tangerineWhistle"]},te={type:"object",properties:{from:{format:"address"},to:{oneOf:[{format:"address"},{type:"null"}]},value:{format:"uint"},gas:{format:"uint"},gasPrice:{format:"uint"},effectiveGasPrice:{format:"uint"},type:{format:"uint"},maxFeePerGas:{format:"uint"},maxPriorityFeePerGas:{format:"uint"},accessList:Object.assign({},N),data:{format:"bytes"},input:{format:"bytes"},nonce:{format:"uint"},chain:Object.assign({},X),hardfork:Object.assign({},_),chainId:{format:"uint"},networkId:{format:"uint"},common:{type:"object",properties:{customChain:Object.assign({},{type:"object",properties:{name:{format:"string"},networkId:{format:"uint"},chainId:{format:"uint"}}}),baseChain:Object.assign({},X),hardfork:Object.assign({},_)}},gasLimit:{format:"uint"},v:{format:"uint"},r:{format:"bytes32"},s:{format:"bytes32"}}},I={type:"object",properties:Object.assign(Object.assign({},te.properties),{blockHash:{format:"bytes32"},blockNumber:{format:"uint"},hash:{format:"bytes32"},transactionIndex:{format:"uint"},from:{format:"address"},to:{oneOf:[{format:"address"},{type:"null"}]},value:{format:"uint"},gas:{format:"uint"},gasPrice:{format:"uint"},effectiveGasPrice:{format:"uint"},type:{format:"uint"},maxFeePerGas:{format:"uint"},maxPriorityFeePerGas:{format:"uint"},accessList:Object.assign({},N),data:{format:"bytes"},input:{format:"bytes"},nonce:{format:"uint"},gasLimit:{format:"uint"},v:{format:"uint"},r:{format:"bytes32"},s:{format:"bytes32"}})},st={type:"object",properties:{index:{format:"uint"},validatorIndex:{format:"uint"},address:{format:"address"},amount:{format:"uint"}}},ee={type:"object",properties:{baseFeePerGas:{format:"uint"},blobGasUsed:{format:"uint"},difficulty:{format:"uint"},excessBlobGas:{format:"uint"},extraData:{format:"bytes"},gasLimit:{format:"uint"},gasUsed:{format:"uint"},hash:{format:"bytes32"},logsBloom:{format:"bytes256"},miner:{format:"bytes"},mixHash:{format:"bytes32"},nonce:{format:"uint"},number:{format:"uint"},parentBeaconBlockRoot:{format:"bytes32"},parentHash:{format:"bytes32"},receiptsRoot:{format:"bytes32"},sha3Uncles:{format:"bytes32"},size:{format:"uint"},stateRoot:{format:"bytes32"},timestamp:{format:"uint"},totalDifficulty:{format:"uint"},transactions:{oneOf:[{type:"array",items:Object.assign({},I)},{type:"array",items:{format:"bytes32"}}]},transactionsRoot:{format:"bytes32"},uncles:{type:"array",items:{format:"bytes32"}},withdrawals:{type:"array",items:Object.assign({},st)},withdrawalsRoot:{format:"bytes32"}}},ne={type:"object",properties:{author:{format:"bytes32"},excessDataGas:{format:"uint"},baseFeePerGas:{format:"uint"},blobGasUsed:{format:"uint"},difficulty:{format:"uint"},excessBlobGas:{format:"uint"},extraData:{format:"bytes"},gasLimit:{format:"uint"},gasUsed:{format:"uint"},hash:{format:"bytes32"},logsBloom:{format:"bytes256"},miner:{format:"bytes"},mixHash:{format:"bytes32"},nonce:{format:"uint"},number:{format:"uint"},parentBeaconBlockRoot:{format:"bytes32"},parentHash:{format:"bytes32"},receiptsRoot:{format:"bytes32"},sha3Uncles:{format:"bytes32"},size:{format:"uint"},stateRoot:{format:"bytes32"},timestamp:{format:"uint"},totalDifficulty:{format:"uint"},transactions:{type:"array",items:{format:"bytes32"}},transactionsRoot:{format:"bytes32"},uncles:{type:"array",items:{format:"bytes32"}},withdrawals:{type:"array",items:Object.assign({},st)},withdrawalsRoot:{format:"bytes32"}}},q={type:"object",properties:{removed:{format:"bool"},logIndex:{format:"uint"},transactionIndex:{format:"uint"},transactionHash:{format:"bytes32"},blockHash:{format:"bytes32"},blockNumber:{format:"uint"},address:{format:"address"},data:{format:"bytes"},topics:{type:"array",items:{format:"bytes32"}}}},j={type:"object",properties:{transactionHash:{format:"bytes32"},transactionIndex:{format:"uint"},blockHash:{format:"bytes32"},blockNumber:{format:"uint"},from:{format:"address"},to:{format:"address"},cumulativeGasUsed:{format:"uint"},gasUsed:{format:"uint"},effectiveGasPrice:{format:"uint"},contractAddress:{format:"address"},logs:{type:"array",items:Object.assign({},q)},logsBloom:{format:"bytes"},root:{format:"bytes"},status:{format:"uint"},type:{format:"uint"}}};function O(a,i=M,t={transactionSchema:I,fillInputAndData:!1}){var e,s;let o=It({},a);if(f(a==null?void 0:a.common)||(o.common=Object.assign({},a.common),f((e=a.common)===null||e===void 0?void 0:e.customChain)||(o.common.customChain=Object.assign({},a.common.customChain))),o=d((s=t.transactionSchema)!==null&&s!==void 0?s:I,o,i),!f(o.data)&&!f(o.input)&&W(o.data)!==W(o.input))throw new yt({data:z(o.data),input:z(o.input)});return t.fillInputAndData&&(f(o.data)?f(o.input)||(o.data=o.input):o.input=o.data),f(o.gasLimit)||(o.gas=o.gasLimit,delete o.gasLimit),o}Object.assign({},{type:"object",properties:{key:{format:"bytes32"},value:{format:"uint"},proof:{type:"array",items:{format:"bytes32"}}}});const ct="ALLEVENTS",oe={name:ct,signature:"",type:"event",inputs:[]},L={bytes:Gt.HEX,number:Ct.NUMBER};var ut=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};function ie(a,i,t){return ut(this,void 0,void 0,function*(){var e,s,o,m;const u=yield function(r){return x(this,arguments,void 0,function*(n,l=n.defaultBlock,v=!1,h){var b;let y;if(Et(l)){const g=d({format:"bytes32"},l,w);y=yield Kt(n.requestManager,g,v)}else{const g=B(l)?l:d({format:"uint"},l,w);y=yield at(n.requestManager,g,v)}const p=d(ee,y,h??n.defaultReturnFormat);return f(p)?p:Object.assign(Object.assign({},p),{transactions:(b=p.transactions)!==null&&b!==void 0?b:[]})})}(i,i.defaultBlock,!1,w);if(f(u.baseFeePerGas))throw new bt;let c;if(f(a.gasPrice)&&BigInt(u.baseFeePerGas)===BigInt(0)&&(c=yield ft(i,t)),!f(a.gasPrice)||!f(c)){const r=d({format:"uint"},(e=a.gasPrice)!==null&&e!==void 0?e:c,t);return{maxPriorityFeePerGas:r,maxFeePerGas:r}}return{maxPriorityFeePerGas:d({format:"uint"},(s=a.maxPriorityFeePerGas)!==null&&s!==void 0?s:i.defaultMaxPriorityFeePerGas,t),maxFeePerGas:d({format:"uint"},(o=a.maxFeePerGas)!==null&&o!==void 0?o:BigInt(u.baseFeePerGas)*BigInt(2)+BigInt((m=a.maxPriorityFeePerGas)!==null&&m!==void 0?m:i.defaultMaxPriorityFeePerGas),t)}})}const Q=(a,i,t,e)=>{if(t!==void 0&&a in t&&t[a]!==void 0){if(typeof t[a]=="string"&&Bt(t[a]))return t[a];if(!Ot(t[a])&&St(t[a])){if(i.wallet){const s=i.wallet.get(d({format:"uint"},t[a],L));if(!f(s))return s.address;throw new U}throw new U}throw a==="from"?new gt(t.from):new wt(t.to)}if(a==="from"){if(!f(e))return vt(e);if(!f(i.defaultAccount))return i.defaultAccount}},re=(a,i)=>{const t=Zt(a,i);return f(t)?f(i.defaultTransactionType)?void 0:d({format:"uint"},i.defaultTransactionType,w):t};var A=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};function E(a,i,t){const e=a.transactionPollingInterval,[s,o]=At(()=>A(this,void 0,void 0,function*(){let m;try{m=yield dt(a,L)}catch(c){return void console.warn("An error happen while trying to get the block number",c)}const u=m-i;if(u>=a.transactionBlockTimeout)return new tt({starterBlockNumber:i,numberOfBlocks:u,transactionHash:t})}),e);return[o,{clean:()=>{clearInterval(s)}}]}function mt(a,i){return A(this,void 0,void 0,function*(){var t,e;const{provider:s}=a.requestManager;let o;const m=yield dt(a,L);return o=!((e=(t=s).supportsSubscriptions)===null||e===void 0)&&e.call(t)&&a.enableExperimentalFeatures.useSubscriptionWhenCheckingBlockTimeout?yield function(u,c,r){return A(this,void 0,void 0,function*(){var n;let l,v,h=!0;function b(y,p){p&&console.warn("error happened at subscription. So revert to polling...",p),v.clean(),h=!1;const[g,P]=E(u,c,r);v.clean=P.clean,g.catch(pt=>y(pt))}try{l=yield(n=u.subscriptionManager)===null||n===void 0?void 0:n.subscribe("newHeads"),v={clean:()=>{var y;l.id&&((y=u.subscriptionManager)===null||y===void 0||y.removeSubscription(l).then(()=>{}).catch(()=>{}))}}}catch{return E(u,c,r)}return[new Promise((y,p)=>{try{l.on("data",g=>{if(h=!1,!(g!=null&&g.number))return;const P=Number(BigInt(g.number)-BigInt(c));P>=u.transactionBlockTimeout&&p(new tt({starterBlockNumber:c,numberOfBlocks:P,transactionHash:r}))}),l.on("error",g=>{b(p,g)})}catch(g){b(p,g)}setTimeout(()=>{h&&b(p)},1e3*u.blockHeaderTimeout)}),v]})}(a,m,i):E(a,m,i),o})}var ae=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};function Y(a,i,t){return ae(this,void 0,void 0,function*(){const[e,s]=rt(a.transactionSendTimeout,new xt({numberOfSeconds:a.transactionSendTimeout/1e3,transactionHash:t})),[o,m]=yield mt(a,t);try{return yield Promise.race([i(),s,o])}finally{clearTimeout(e),m.clean()}})}var Z=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};function se(a,i,t,e){return Z(this,void 0,void 0,function*(){var s;const o=(s=a.transactionReceiptPollingInterval)!==null&&s!==void 0?s:a.transactionPollingInterval,[m,u]=Mt(()=>Z(this,void 0,void 0,function*(){try{return(e??pe)(a,i,t)}catch(v){return void console.warn("An error happen while trying to get the transaction receipt",v)}}),o),[c,r]=rt(a.transactionPollingTimeout,new et({numberOfSeconds:a.transactionPollingTimeout/1e3,transactionHash:i})),[n,l]=yield mt(a,i);try{return yield Promise.race([m,r,n])}finally{c&&clearTimeout(c),u&&clearInterval(u),l.clean()}})}var ce=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};const R=({web3Context:a,transactionReceipt:i,transactionPromiEvent:t,customTransactionReceiptSchema:e,returnFormat:s})=>{var o;let m=1;const u=setInterval(()=>{ce(void 0,void 0,void 0,function*(){if(m>=a.transactionConfirmationBlocks)return void clearInterval(u);const c=yield at(a.requestManager,T(BigInt(i.blockNumber)+BigInt(m)),!1);c!=null&&c.hash&&(m+=1,t.emit("confirmation",{confirmations:d({format:"uint"},m,s),receipt:d(e??j,i,s),latestBlockHash:d({format:"bytes32"},c.hash,s)}))})},(o=a.transactionReceiptPollingInterval)!==null&&o!==void 0?o:a.transactionPollingInterval)};var $=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};function ue(a,i,t,e,s,o){if(f(t)||f(t.blockHash))throw new Pt({receipt:t,blockHash:d({format:"bytes32"},t==null?void 0:t.blockHash,s),transactionHash:d({format:"bytes32"},e,s)});if(!t.blockNumber)throw new kt({receipt:t});i.emit("confirmation",{confirmations:d({format:"uint"},1,s),receipt:d(o??j,t,s),latestBlockHash:d({format:"bytes32"},t.blockHash,s)});const m=a.requestManager.provider;m&&"supportsSubscriptions"in m&&m.supportsSubscriptions()?(({web3Context:u,transactionReceipt:c,transactionPromiEvent:r,customTransactionReceiptSchema:n,returnFormat:l})=>{let v,h=!0;setImmediate(()=>{var b;(b=u.subscriptionManager)===null||b===void 0||b.subscribe("newHeads").then(y=>{y.on("data",p=>$(void 0,void 0,void 0,function*(){var g;if(h=!1,!(p!=null&&p.number)||v===(p==null?void 0:p.parentHash))return;v=p==null?void 0:p.parentHash;const P=BigInt(p.number)-BigInt(c.blockNumber)+BigInt(1);r.emit("confirmation",{confirmations:d({format:"uint"},P,l),receipt:d(n??j,c,l),latestBlockHash:d({format:"bytes32"},p.parentHash,l)}),P>=u.transactionConfirmationBlocks&&(yield(g=u.subscriptionManager)===null||g===void 0?void 0:g.removeSubscription(y))})),y.on("error",()=>$(void 0,void 0,void 0,function*(){var p;yield(p=u.subscriptionManager)===null||p===void 0?void 0:p.removeSubscription(y),h=!1,R({web3Context:u,transactionReceipt:c,transactionPromiEvent:r,customTransactionReceiptSchema:n,returnFormat:l})}))}).catch(()=>{h=!1,R({web3Context:u,transactionReceipt:c,customTransactionReceiptSchema:n,transactionPromiEvent:r,returnFormat:l})})}),setTimeout(()=>{h&&R({web3Context:u,transactionReceipt:c,transactionPromiEvent:r,returnFormat:l})},1e3*u.blockHeaderTimeout)})({web3Context:a,transactionReceipt:t,transactionPromiEvent:i,customTransactionReceiptSchema:o,returnFormat:s}):R({web3Context:a,transactionReceipt:t,transactionPromiEvent:i,customTransactionReceiptSchema:o,returnFormat:s})}var me=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};function lt(a,i,t){return me(this,arguments,void 0,function*(e,s,o,m=e.defaultReturnFormat){try{return void(yield ve(e,s,e.defaultBlock,m))}catch(u){return((c,r)=>{var n,l,v,h,b;if(c instanceof C&&c.cause instanceof jt){if(r!==void 0){const y=r.filter(p=>Xt(p));return _t(y,c.cause),{reason:c.cause.message,signature:(n=c.cause.data)===null||n===void 0?void 0:n.slice(0,10),data:(l=c.cause.data)===null||l===void 0?void 0:l.substring(10),customErrorName:c.cause.errorName,customErrorDecodedSignature:c.cause.errorSignature,customErrorArguments:c.cause.errorArgs}}return{reason:c.cause.message,signature:(v=c.cause.data)===null||v===void 0?void 0:v.slice(0,10),data:(h=c.cause.data)===null||h===void 0?void 0:h.substring(10)}}if(c instanceof nt&&!Array.isArray((b=c.cause)===null||b===void 0?void 0:b.errors)&&c.cause!==void 0)return c.cause.message;throw c})(u,o)}})}var le=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};function G(a,i,t,e,s,o){return le(this,void 0,void 0,function*(){let m,u=o;if(u===void 0&&a.handleRevert&&i!==void 0&&(u=yield lt(a,i,s)),u===void 0)m=new ot(t);else if(typeof u=="string")m=new H(u,void 0,t);else if(u.customErrorName!==void 0&&u.customErrorDecodedSignature!==void 0&&u.customErrorArguments!==void 0){const c=u;m=new it(c.reason,c.customErrorName,c.customErrorDecodedSignature,c.customErrorArguments,c.signature,t,c.data)}else m=new H(u.reason,u.signature,t,u.data);return m})}const fe=(a,i,t,e=M)=>{var s,o,m,u,c,r;let n=Object.assign({},a);const l=d(q,i,e);if([ct,"allEvents"].includes(n.name)&&(n=t.find(b=>b.signature===i.topics[0])||{anonymous:!0}),n.inputs=(o=(s=n.inputs)!==null&&s!==void 0?s:a.inputs)!==null&&o!==void 0?o:[],!n.anonymous){let h=0;((m=n.inputs)!==null&&m!==void 0?m:[]).forEach(b=>{b.indexed&&(h+=1)}),h>0&&(i!=null&&i.topics)&&(i==null?void 0:i.topics.length)!==h+1&&(n=Object.assign(Object.assign({},n),{anonymous:!0,inputs:[]}))}const v=n.anonymous?i.topics:((u=i.topics)!==null&&u!==void 0?u:[]).slice(1);return Object.assign(Object.assign({},l),{returnValues:Qt([...(c=n.inputs)!==null&&c!==void 0?c:[]],i.data,v),event:n.name,signature:!n.anonymous&&((r=i.topics)===null||r===void 0?void 0:r.length)>0&&i.topics[0]?i.topics[0]:void 0,raw:{data:i.data,topics:i.topics}})};var k=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};class de{constructor({options:i,web3Context:t,promiEvent:e,returnFormat:s}){this.options={checkRevertBeforeSending:!0},this.options=i,this.web3Context=t,this.promiEvent=e,this.returnFormat=s}getReceiptWithEvents(i){var t,e;const s=Object.assign({},i??{});if(!((t=this.options)===null||t===void 0)&&t.contractAbi&&s.logs&&s.logs.length>0){s.events={};for(const o of s.logs){const m=fe(oe,o,(e=this.options)===null||e===void 0?void 0:e.contractAbi,this.returnFormat);m.event&&(s.events[m.event]=m)}}return s}checkRevertBeforeSending(i){return k(this,void 0,void 0,function*(){if(this.options.checkRevertBeforeSending!==!1){let t=i;f(i.data)&&f(i.input)&&f(i.gas)&&(t=Object.assign(Object.assign({},i),{gas:21e3}));const e=yield lt(this.web3Context,t,this.options.contractAbi);if(e!==void 0)throw yield G(this.web3Context,i,void 0,0,this.options.contractAbi,e)}})}emitSending(i){this.promiEvent.listenerCount("sending")>0&&this.promiEvent.emit("sending",i)}populateGasPrice(i){return k(this,arguments,void 0,function*({transactionFormatted:t,transaction:e}){var s;let o=t;return this.web3Context.config.ignoreGasPricing||!((s=this.options)===null||s===void 0)&&s.ignoreGasPricing||!f(t.gasPrice)||!f(e.maxPriorityFeePerGas)&&!f(e.maxFeePerGas)||(o=Object.assign(Object.assign({},t),yield function(m,u,c){return ut(this,void 0,void 0,function*(){const r=re(m,u);if(!f(r)){if(r.startsWith("-"))throw new D(r);if(Number(r)<0||Number(r)>127)throw new D(r);if(f(m.gasPrice)&&(r==="0x0"||r==="0x1"))return{gasPrice:yield ft(u,c),maxPriorityFeePerGas:void 0,maxFeePerGas:void 0};if(r==="0x2")return Object.assign({gasPrice:void 0},yield ie(m,u,c))}})}(t,this.web3Context,w))),o})}signAndSend(i){return k(this,arguments,void 0,function*({wallet:t,tx:e}){if(t){const s=yield t.signTransaction(e);return Y(this.web3Context,()=>k(this,void 0,void 0,function*(){return Nt(this.web3Context.requestManager,s.rawTransaction)}),s.transactionHash)}return Y(this.web3Context,()=>k(this,void 0,void 0,function*(){return qt(this.web3Context.requestManager,e)}))})}emitSent(i){this.promiEvent.listenerCount("sent")>0&&this.promiEvent.emit("sent",i)}emitTransactionHash(i){this.promiEvent.listenerCount("transactionHash")>0&&this.promiEvent.emit("transactionHash",i)}emitReceipt(i){this.promiEvent.listenerCount("receipt")>0&&this.promiEvent.emit("receipt",i)}handleError(i){return k(this,arguments,void 0,function*({error:t,tx:e}){var s;let o=t;return o instanceof C&&this.web3Context.handleRevert&&(o=yield G(this.web3Context,e,void 0,0,(s=this.options)===null||s===void 0?void 0:s.contractAbi)),(o instanceof nt||o instanceof C||o instanceof it||o instanceof ot||o instanceof H||o instanceof et)&&this.promiEvent.listenerCount("error")>0&&this.promiEvent.emit("error",o),o})}emitConfirmation({receipt:i,transactionHash:t,customTransactionReceiptSchema:e}){this.promiEvent.listenerCount("confirmation")>0&&ue(this.web3Context,this.promiEvent,i,t,this.returnFormat,e)}handleResolve(i){return k(this,arguments,void 0,function*({receipt:t,tx:e}){var s,o,m;if(!((s=this.options)===null||s===void 0)&&s.transactionResolver)return(o=this.options)===null||o===void 0?void 0:o.transactionResolver(t);if(t.status===BigInt(0)){const u=yield G(this.web3Context,e,t,0,(m=this.options)===null||m===void 0?void 0:m.contractAbi);throw this.promiEvent.listenerCount("error")>0&&this.promiEvent.emit("error",u),u}return t})}}var x=function(a,i,t,e){return new(t||(t=Promise))(function(s,o){function m(r){try{c(e.next(r))}catch(n){o(n)}}function u(r){try{c(e.throw(r))}catch(n){o(n)}}function c(r){var n;r.done?s(r.value):(n=r.value,n instanceof t?n:new t(function(l){l(n)})).then(m,u)}c((e=e.apply(a,i||[])).next())})};function ft(a,i){return x(this,void 0,void 0,function*(){const t=yield Jt(a.requestManager);return d({format:"uint"},t,i??a.defaultReturnFormat)})}function dt(a,i){return x(this,void 0,void 0,function*(){const t=yield zt(a.requestManager);return d({format:"uint"},t,i??a.defaultReturnFormat)})}function pe(a,i,t){return x(this,void 0,void 0,function*(){const e=d({format:"bytes32"},i,M);let s;try{s=yield Vt(a.requestManager,e)}catch(o){if(typeof o!="object"||f(o)||!("message"in o)||o.message!=="transaction indexing is in progress")throw o;console.warn("Transaction indexing is in progress.")}return f(s)?s:d(j,s,t??a.defaultReturnFormat)})}function Be(a,i,t,e={checkRevertBeforeSending:!0},s){const o=new Ht((m,u)=>{setImmediate(()=>{x(this,void 0,void 0,function*(){const c=new de({web3Context:a,promiEvent:o,options:e,returnFormat:t});let r=Object.assign({},i);f(s)||(r=yield s.processTransaction(r));let n=O(Object.assign(Object.assign({},r),{from:Q("from",a,r),to:Q("to",a,r)}),w,{transactionSchema:a.config.customTransactionSchema});try{let l;n=yield c.populateGasPrice({transaction:r,transactionFormatted:n}),yield c.checkRevertBeforeSending(n),c.emitSending(n),a.wallet&&!f(n.from)&&(l=a.wallet.get(n.from));const v=yield c.signAndSend({wallet:l,tx:n}),h=d({format:"bytes32"},v,t??a.defaultReturnFormat);c.emitSent(n),c.emitTransactionHash(h);const b=yield se(a,v,t??a.defaultReturnFormat),y=c.getReceiptWithEvents(d(j,b,t??a.defaultReturnFormat));c.emitReceipt(y),m(yield c.handleResolve({receipt:y,tx:n})),c.emitConfirmation({receipt:y,transactionHash:v})}catch(l){u(yield c.handleError({error:l,tx:n}))}})})});return o}function ve(a,i){return x(this,arguments,void 0,function*(t,e,s=t.defaultBlock,o=t.defaultReturnFormat){const m=B(s)?s:d({format:"uint"},s,w),u=yield Lt(t.requestManager,O(e,w,{transactionSchema:t.config.customTransactionSchema}),m);return d({format:"bytes"},u,o)})}function Oe(a,i){return x(this,arguments,void 0,function*(t,e,s=t.defaultBlock,o){const m=O(e,w,{transactionSchema:t.config.customTransactionSchema}),u=B(s)?s:d({format:"uint"},s,w),c=yield Dt(t.requestManager,m,u);return d({format:"uint"},c,o??t.defaultReturnFormat)})}function Se(a,i,t){return x(this,void 0,void 0,function*(){let{toBlock:e,fromBlock:s}=i;f(e)||typeof e!="number"&&typeof e!="bigint"||(e=T(e)),f(s)||typeof s!="number"&&typeof s!="bigint"||(s=T(s));const o=Object.assign(Object.assign({},i),{fromBlock:s,toBlock:e});return(yield Ut(a.requestManager,o)).map(m=>typeof m=="string"?m:d(q,m,t??a.defaultReturnFormat))})}function Ee(a,i){return x(this,arguments,void 0,function*(t,e,s=t.defaultBlock,o){const m=B(s)?s:d({format:"uint"},s,w),u=yield Wt(t.requestManager,O(e,w,{transactionSchema:t.config.customTransactionSchema}),m);return d($t,u,o??t.defaultReturnFormat)})}class Ge extends Tt{_buildSubscriptionParams(){return["newHeads"]}formatSubscriptionResult(i){return d(ne,i,super.returnFormat)}}export{ct as A,Ge as N,oe as a,ee as b,ve as c,fe as d,Ee as e,Oe as f,Se as g,O as h,Be as s};
